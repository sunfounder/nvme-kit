.. note::

    您好，欢迎加入 SunFounder 的 Raspberry Pi、Arduino 和 ESP32 爱好者 Facebook 社区！与志同道合的朋友一起深入探索 Raspberry Pi、Arduino 和 ESP32 的无限可能。

    **为什么加入？**

    - **专家支持**：在社区和官方团队的帮助下解决售后问题和技术难题。
    - **学习与分享**：交流技巧和教程，提升技能。
    - **独家预览**：抢先了解新产品发布和独家预览内容。
    - **专属折扣**：享受我们最新产品的专属优惠。
    - **节日促销与抽奖**：参与节日特别活动和抽奖。

    👉 准备好一起探索与创造了吗？点击 [|link_sf_facebook|] 立即加入！

================================================
FAQ - NVMe Kit 系列常见问题
================================================

本节涵盖 **SunFounder NVMe Kit 系列** 的常见问题，包括
**Dual NVMe Raft** 与 **General NVMe PIP** 两款产品。

如果您不确定自己拥有哪种型号，请参阅 :ref:`identify_model`。

.. contents::
   :local:
   :depth: 2
   :backlinks: none

通用问题
=================

Q1. 如何区分我的是哪种 NVMe Kit？
----------------------------------------------------------------
**Dual NVMe Raft** 支持两块 NVMe SSD，而 **General NVMe PIP** 仅支持一块。  
如果您的板上有两个 M.2 插槽且尺寸更大，那就是 Dual NVMe Raft。

Q2. PWR 指示灯不亮，我该检查什么？
-----------------------------------
1. 确保 FPC（PCIe）线缆正确连接并方向无误。  
2. 请使用官方 **27 W 树莓派 5 电源适配器**——功率不足的电源可能导致指示灯不亮。  
3. 检查板上的 **FORCE EN** 跳线是否设置正确。  
4. 若仍无反应，可尝试提供外部 5V 辅助电源。

Q3. 系统无法识别我的 SSD。
--------------------------------
请检查以下项目：

- 运行 ``dmesg | grep pcie`` 确认 PCIe 是否正确初始化。  
- 执行 ``lspci`` 与 ``ls /dev/nvme*`` 查看 SSD 是否被识别。  
- 确认 ``/boot/firmware/config.txt`` 中包含 ``dtparam=pciex1`` 或 ``dtparam=nvme``。  
- 重新插拔 SSD 或更换线缆后再试。

Q4. 树莓派无法从 NVMe SSD 启动。
---------------------------------
- 确认您已 **更新启动加载程序（bootloader）** 以支持 NVMe/USB 启动。  
- EEPROM 启动顺序需设置为优先从 PCIe 启动。  
- 检查 ``dtparam=pciex1_no_l0s=on`` 是否已启用。  
- 确保 NVMe SSD 上写入了有效的系统镜像（参见 :ref:`install_raspberry_os`）。

Q5. “FORCE ENABLE” 跳线的作用是什么？
--------------------------------------
FORCE EN（J4）跳线用于在未接收到 PCIe 电源信号时**手动启用 3.3V 电源**，  
确保 NVMe SSD 得到供电。仅当 SSD 无法自动上电时使用。

Q6. 能否使用更长的 FPC 线缆？
--------------------------------
不建议。套件内附的线缆已针对信号完整性优化，  
使用更长的线缆可能导致连接不稳定或无法识别。

Q7. 为什么我的 SSD 很烫？
--------------------------------
NVMe SSD 在高负载下温度升高属正常现象。  

- 请确保有良好的气流或主动散热。  
- 避免将树莓派与 NVMe 扩展板封闭在密闭壳体中。  
- 部分 SSD 会在约 70°C 时自动降速以保护芯片。

Q8. 系统识别到 SSD，但无法格式化。
------------------------------------
若在 ``lsblk`` 中能看到 SSD，却无法格式化：

- 请确认该分区未被挂载。  
- 使用 ``sudo fdisk /dev/nvme0n1`` 删除旧分区。  
- 然后用 ``mkfs.ext4 /dev/nvme0n1p1`` 重新创建文件系统。

Q9. 电源灯闪烁或 NVMe 在高负载下断连。
-----------------------------------------
这通常是 **供电不足** 导致的。  

- 使用官方 27W 电源。  
- 不要从同一 USB 口再取电给其他设备。  
- 如有需要，可使用扩展板的外接 5V 电源接口。

Q10. 修改配置后 PCIe 或 NVMe 无法初始化。
-------------------------------------------
若 ``dmesg`` 输出中出现 PCIe 错误：

- 检查 ``/boot/firmware/config.txt`` 文件语法是否正确。  
- 删除多余空格或重复的 ``dtparam`` 行。  
- 如问题仍在，可使用 Micro SD 恢复镜像重置 bootloader。

Q11. 更新 Raspberry Pi OS 是否安全？
-------------------------------------
是的，建议定期更新。但请在更新前**备份数据**。  
若更新后无法启动，可使用 Raspberry Pi Imager 重新刷新 bootloader。

Q12. 是否可以将现有系统复制到 NVMe SSD？
---------------------------------------------
可以。使用 Raspberry Pi OS 自带的 **SD Card Copier** 工具，  
可将 Micro SD 卡完整复制到 NVMe 硬盘。  
详见 :ref:`copy_sd_to_nvme_rpi`。

Q13. 安装 OpenMediaVault 后无法检测到硬盘。
----------------------------------------------
- 请确保使用的是 **Raspberry Pi OS Lite** 而非桌面版。  
- 确认 SSD 已正确挂载并格式化为 ext4。  
- 运行 ``lsblk`` 检查系统是否识别到磁盘。

Q14. 在 OpenMediaVault 设置 RAID 时出现 “500 Internal Server Error”。
-------------------------------------------------------------------------------------------------
请重启 OMV 服务：

.. code-block:: bash

   sudo systemctl restart openmediavault

并重试。  
确保至少连接了两块硬盘以创建 RAID 0/1。

Dual NVMe Raft 专属问题
==================================================

Q15. Dual NVMe Raft 是否需要安装驱动？
----------------------------------------
不需要。Raspberry Pi OS Bookworm 及主流 Linux 内核均原生支持 PCIe NVMe。

Q16. 是否支持 PCIe Gen 3 或更高版本 SSD？
--------------------------------------------
支持，但由于树莓派 5 的限制，所有设备都会以 **PCIe Gen 2** 速率运行。

Q17. 只装一块 NVMe SSD 可以正常使用吗？
------------------------------------------
可以。Dual NVMe Raft 在仅插一块 SSD 时也能正常运行。

Q18. 同时使用两块 SSD 会降低性能吗？
-----------------------------------------
会有轻微影响。两块 SSD 共用一条 PCIe 2.0 通道，  
在同时传输数据时带宽会被分配。

Q19. 是否可以一槽用于 AI 加速器，一槽用于存储？
---------------------------------------------------
可以。您可以在一个插槽插入 **Hailo AI 加速模块**，  
另一个插槽插入 NVMe SSD。

General NVMe PIP 专属问题
====================================================

Q20. NVMe PIP 是否支持热插拔？
--------------------------------
不支持。树莓派 5 的 PCIe 接口 **不支持热插拔**。  
请务必在断电状态下插拔 SSD。

Q21. PIP 可以安装在树莓派上方或侧边吗？
-------------------------------------------
可以。它支持 **上下/侧向双安装方式**，  
可根据需要使用附带的铜柱和 FPC 线缆。  
请注意避免线缆扭曲或过度弯折。

Q22. NVMe PIP 是否需要外接电源？
-----------------------------------
通常不需要。但若使用高功耗 SSD（>5 W），  
建议连接 2 针外部 5V 辅助电源接口。

兼容性与其他问题
==================

Q23. 哪些 SSD 型号兼容？
--------------------------
请参阅 :ref:`compatible_nvme_ssds` 了解已测试列表。  
避免使用带 **Phison 控制器** 的型号（如 WD SN770、Corsair MP600）。

Q24. 为什么我的 Western Digital Blue SN550 无法启动？
--------------------------------------------------------
旧版 bootloader 无法识别该型号。  
请运行 ``sudo rpi-eeprom-update`` 安装最新版本 ``pieeprom-2024-01-24.bin``。

Q25. AI Kit、AI HAT+ 与 NVMe 模组之间的兼容性
-----------------------------------------------
**Raspberry Pi AI Kit** 与 **AI HAT+** 均为树莓派官方产品，但设计不同：

- **Raspberry Pi AI Kit** 包含 **M.2 HAT+ 扩展板** 与一块 **可拆卸的 Hailo-8L M.2 模块（2242, M-Key）**。  

  模块默认安装在 M.2 HAT+ 上，可拆下后 **直接装入 General NVMe PIP** （M-Key 插槽）使用。  
  拆装时请确保充分散热与供电。


   .. image::  img/output2.jpg
      :width: 400


- **Raspberry Pi AI HAT+** 是一块 **集成式 HAT+ 扩展板**，板上直接焊接 **Hailo 加速芯片（Hailo-8L 13 TOPS 或 Hailo-8 26 TOPS）**。 

  芯片不可拆卸，也 **不能与 NVMe 扩展板共用同一 PCIe 通道**。

   .. image::  img/output3.png
      :width: 400


.. note::
   当您将 AI Kit 中的 Hailo 模块安装到 NVMe PIP 时，请注意：

   - 确认模块规格为 **M.2 2242, M-Key**，并确保螺柱孔位匹配；  
   - 提供充分散热（Hailo 模块在负载时温度可达 70°C 以上）；  
   - 软件部分请按照 Raspberry Pi 官方 AI Kit 文档安装 Hailo SDK 与驱动。

Q26. 树莓派是否支持 RAID 0/1？
--------------------------------
支持，通过 **OpenMediaVault 软件 RAID** 实现。  
RAID 0 追求性能，RAID 1 注重数据冗余。

Q27. NVMe SSD 在重启后消失。
------------------------------
可能原因如下：

- 启动时 PCIe 未正确初始化（检查 ``config.txt``）。  
- 电源供应不足。  
- SSD 启动电流超过 3A。

Q28. 我可以在哪里获取帮助或反馈？
------------------------------------
欢迎加入 **SunFounder 树莓派爱好者社区（Facebook）**，  
与其他用户交流问题、经验和项目创意。
